<main class="spending-statistic">

  @if(currCategory) {
    <pgz-prev-route></pgz-prev-route>
    <h2>{{currCategory.title}} statistic</h2>
  }@else {
    <h2>Statistic</h2>
  }
  
  <div class="chart-container--chart">

    <pgz-toggle-switch [checked]="'multiline'" [unchecked]="'pie'" (buttonValue)="chartTypeChange($event)"></pgz-toggle-switch>
    <pgz-range-controller (isCompareEnabled)="toogleCompare()" (rangeChange)="onRangeChange($event)"></pgz-range-controller>
      
    <div class="chart-container--chart">
      @if(chartTypeCtrl === 'pie') { 
        <div>
          <pgz-pie-chart-container 
            [categoryData]="categoryStatisticForPieChart" 
            [isCompareEnabled]="isCompareEnabled" 
            [compareCategoryData]="getCompareCategoryStatisticForPieChart()"
          ></pgz-pie-chart-container>
        </div>
      }

      @if(chartTypeCtrl === 'multiline') {
        <pgz-multi-line-chart-container 
          [activeCategories]="categoryStatisticForPeriod" 
          [isCompareEnabled]="isCompareEnabled"
          [spendings]="spendingsForMultiLineChart"
          [compareSpendings]="compareSpendingsForMultiLineChart"
          [startRange]="formRange.value.startDate"
          [startCompareRange]="formRange.value.compareStartDate"
          (chartColors)="chartsColors($event)"
        ></pgz-multi-line-chart-container>
      }
    </div>
  </div>

  <mat-drawer-container class="spending-statistic-list" [hasBackdrop]="false" autosize>
    <mat-drawer #drawer mode="over">
      <section class="spending-statistic-list--filters">
        <mat-checkbox 
            [checked]="isAllCategoriesChecked"
            (change)="toggleAllCategories()"
            >
            <p>All Categories</p>
        </mat-checkbox>
        @for(categoryStatistic of categoryStatisticForPeriod; track categoryStatistic) {
            <mat-checkbox 
                [checked]="isVisibleCategory(categoryStatistic.category.id)"
                (change)="toggleCategory(categoryStatistic, $event.checked)"
                >
                <p>{{ categoryStatistic.category.title }}</p>
            </mat-checkbox>
        }
    </section>
</mat-drawer>
  <section style="display: flex; flex-direction: column;">
    <button style="margin-left: auto;" type="button" mat-button (click)="drawer.toggle()">
      Filter
  </button>
    <!-- <div class="d-flex justify-content-between"> -->
      <!-- <button class="btn" (click)="changeSortBy()">
        @if(isAscSort){
          <pgz-icon [name]="'arrow_drop_up'"></pgz-icon>
        } @else {
          <pgz-icon [name]="'arrow_drop_down'"></pgz-icon>
        }
      </button> -->

      <!-- <button class="btn d-flex" (click)="allCategoriesVisible()">
        All visible
        <pgz-icon [name]="'visibility'"></pgz-icon>
      </button> -->
    <!-- </div> -->

    @for(data of categoryStatisticForPeriod; let i = $index; track data) {
      <!-- @if(data.value !== 0) { -->
        <pgz-spending-statistic-card 
          [data]="data"
          [compareData]="getCompareDataForCard(data.category.id)"
          [isCompareMode]="isCompareEnabled"
          [startRange]="formRange.value.startDate"
          [startCompareRange]="formRange.value.compareStartDate"
          [isVisible]="isVisibleCategory(data.category.id)" 
          [chartsColors]="chartsColorsForCompare"
          (clickCard)="onCardClick($event)" >
        </pgz-spending-statistic-card>
      <!-- } -->
    } @empty {
      <p style="text-align: center;">You don't have any spendings</p>
    }
  </section>
</mat-drawer-container>
</main>
